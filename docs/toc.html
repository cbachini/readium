<!DOCTYPE html>  <html> <head>   <title>toc.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="plugins.html">                 plugins.js               </a>                                           <a class="source" href="web_plugins.html">                 web_plugins.js               </a>                                           <a class="source" href="alternate_style_tag_selector.html">                 alternate_style_tag_selector.js               </a>                                           <a class="source" href="audioClipPlayer.html">                 audioClipPlayer.js               </a>                                           <a class="source" href="epub.html">                 epub.js               </a>                                           <a class="source" href="epub_controller.html">                 epub_controller.js               </a>                                           <a class="source" href="ibooks_options_parser.html">                 ibooks_options_parser.js               </a>                                           <a class="source" href="manifest_item.html">                 manifest_item.js               </a>                                           <a class="source" href="mediaOverlay.html">                 mediaOverlay.js               </a>                                           <a class="source" href="media_overlay_controller.html">                 media_overlay_controller.js               </a>                                           <a class="source" href="media_overlay_view_helper.html">                 media_overlay_view_helper.js               </a>                                           <a class="source" href="options_presenter.html">                 options_presenter.js               </a>                                           <a class="source" href="packageDocument.html">                 packageDocument.js               </a>                                           <a class="source" href="package_document_parser.html">                 package_document_parser.js               </a>                                           <a class="source" href="page_number_display_logic.html">                 page_number_display_logic.js               </a>                                           <a class="source" href="pagination_strategy_selector.html">                 pagination_strategy_selector.js               </a>                                           <a class="source" href="path_resolver.html">                 path_resolver.js               </a>                                           <a class="source" href="readium_options.html">                 readium_options.js               </a>                                           <a class="source" href="readium_pagination.html">                 readium_pagination.js               </a>                                           <a class="source" href="smilModel.html">                 smilModel.js               </a>                                           <a class="source" href="toc.html">                 toc.js               </a>                                           <a class="source" href="trigger.html">                 trigger.js               </a>                                           <a class="source" href="validated_package_meta_data.html">                 validated_package_meta_data.js               </a>                                           <a class="source" href="crx_library_namespace.html">                 crx_library_namespace.js               </a>                                           <a class="source" href="crx_viewer_namespace.html">                 crx_viewer_namespace.js               </a>                                           <a class="source" href="ws_lib_namespace.html">                 ws_lib_namespace.js               </a>                                           <a class="source" href="crx_library_router.html">                 crx_library_router.js               </a>                                           <a class="source" href="crx_viewer_router.html">                 crx_viewer_router.js               </a>                                           <a class="source" href="ws_router.html">                 ws_router.js               </a>                                           <a class="source" href="accessibility.html">                 accessibility.js               </a>                                           <a class="source" href="bb_file_system_sync.html">                 bb_file_system_sync.js               </a>                                           <a class="source" href="cookie_utils.html">                 cookie_utils.js               </a>                                           <a class="source" href="google_analytics_loader.html">                 google_analytics_loader.js               </a>                                           <a class="source" href="handlebars_helpers.html">                 handlebars_helpers.js               </a>                                           <a class="source" href="local_storage_sync.html">                 local_storage_sync.js               </a>                                           <a class="source" href="md5.html">                 md5.js               </a>                                           <a class="source" href="user_agent_utils.html">                 user_agent_utils.js               </a>                                           <a class="source" href="fixed_layout_book_zoomer.html">                 fixed_layout_book_zoomer.js               </a>                                           <a class="source" href="nav_widget_view.html">                 nav_widget_view.js               </a>                                           <a class="source" href="options_view.html">                 options_view.js               </a>                                           <a class="source" href="toc_view.html">                 toc_view.js               </a>                                           <a class="source" href="toolbar_view.html">                 toolbar_view.js               </a>                                           <a class="source" href="httpFileApi.html">                 httpFileApi.js               </a>                                           <a class="source" href="library.html">                 library.js               </a>                                           <a class="source" href="viewer.html">                 viewer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               toc.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

	<span class="nx">sync</span><span class="o">:</span> <span class="nx">BBFileSystemSync</span><span class="p">,</span>

	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">file_path</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">file_path</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">book</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">book</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:toc_visible&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">setVisibility</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:toolbar_visible&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">setTocVis</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Rationale: Readium expects that any hrefs to EPUB content are either absolute references or references to the content relative
  to the EPUBs package document. Since any href passed to this method is specified as either absolute (in which case we 
  don't need to worry) or as relative to the nav document (where the click was generated, as this is the toc), we need
  to construct an absolute path from that.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">handleLink</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">href</span><span class="p">)</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">TOCHref</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">packageDocument</span><span class="p">.</span><span class="nx">getTocItem</span><span class="p">().</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>If toc is in the same folder as the package document, use the href straight</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">TOCHref</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">goToHref</span><span class="p">(</span><span class="nx">href</span><span class="p">);</span>	
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>If the href target is in a child folder of the toc folder, create the relative URI
If the href target is in a parent folder of the toc folder, this will fail, for now.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="kd">var</span> <span class="nx">TOC_URI</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URI</span><span class="p">(</span><span class="nx">TOCHref</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">targetHrefURI</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URI</span><span class="p">(</span><span class="nx">href</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Use the TOC path, relative to the package document to create an href for the target resource which will also be relative
  to the package document (or absolute, if the href for the TOC was absolute).</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">href</span> <span class="o">=</span> <span class="nx">targetHrefURI</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">TOC_URI</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">goToHref</span><span class="p">(</span><span class="nx">href</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>

	<span class="nx">setVisibility</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;visible&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;toc_visible&quot;</span><span class="p">));</span>
	<span class="p">},</span>

	<span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;toc_visible&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
	<span class="p">},</span>

	<span class="nx">setTocVis</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;toolbar_visible&quot;</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;toc_visible&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>

	<span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
		<span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span>
	<span class="p">}</span>

<span class="p">},</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Class Level Attributes!</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">XHTML_MIME</span><span class="o">:</span> <span class="s2">&quot;application/xhtml+xml&quot;</span><span class="p">,</span>
	<span class="nx">XML_MIME</span><span class="o">:</span> <span class="s2">&quot;text/xml&quot;</span><span class="p">,</span>	
	<span class="nx">NCX_MIME</span><span class="o">:</span> <span class="s2">&quot;application/x-dtbncx+xml&quot;</span><span class="p">,</span>
	<span class="nx">getToc</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">manItem</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">media_type</span> <span class="o">=</span> <span class="nx">manItem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;media_type&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">media_type</span> <span class="o">===</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span><span class="p">.</span><span class="nx">XHTML_MIME</span> <span class="o">||</span> 
				<span class="nx">media_type</span> <span class="o">===</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span><span class="p">.</span><span class="nx">XML_MIME</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">XhtmlToc</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">media_type</span> <span class="o">===</span>  <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span><span class="p">.</span><span class="nx">NCX_MIME</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">NcxToc</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">});</span>


<span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">NcxToc</span> <span class="o">=</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

	<span class="nx">jath_template</span><span class="o">:</span> <span class="p">{</span>

		<span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;//ncx:docTitle/ncx:text&quot;</span><span class="p">,</span>

		<span class="nx">navs</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;//ncx:navMap/ncx:navPoint&quot;</span><span class="p">,</span> <span class="p">{</span> 
			<span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;ncx:navLabel/ncx:text&quot;</span><span class="p">,</span>
			<span class="nx">href</span><span class="o">:</span> <span class="s2">&quot;ncx:content/@src&quot;</span>
		<span class="p">}</span> <span class="p">]</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Rationale: This method does not use JATH to parse an NCX document, as JATH doesn't really support elements nested 
  recursively, as is possibly the case for navPoint elements in an NCX document. </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xmlDom</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">ncxJson</span> <span class="o">=</span> <span class="p">{};</span>

		<span class="kd">var</span> <span class="nx">$navMap</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DOMParser</span><span class="p">;</span>
      		<span class="nx">xmlDom</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Get NCX TOC text title</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">ncxJson</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;docTitle&quot;</span><span class="p">,</span> <span class="nx">xmlDom</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">text</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>For each navpoint, create navPoint objects recursively</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">ncxJson</span><span class="p">.</span><span class="nx">navs</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="nx">$navMap</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;navMap&quot;</span><span class="p">,</span> <span class="nx">xmlDom</span><span class="p">);</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$navMap</span><span class="p">.</span><span class="nx">children</span><span class="p">(),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;navPoint&quot;</span><span class="p">))</span> <span class="p">{</span>

				<span class="nx">ncxJson</span><span class="p">.</span><span class="nx">navs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">createNavPointObject</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
			<span class="p">}</span>
		<span class="p">});</span>

		<span class="k">return</span> <span class="nx">ncxJson</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Description: Creates an object that represents a NCX navPoint. <br />
Rationale: Since navPoints can be nested within each other, this method creates each navPoint object recursively.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">createNavPointObject</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$navPoint</span><span class="p">)</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">jsonNavPoint</span> <span class="o">=</span> <span class="p">{};</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Each navPoint object has a content src, a label and 0 or more child navPoints</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">jsonNavPoint</span><span class="p">.</span><span class="nx">navs</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">$navPoint</span><span class="p">.</span><span class="nx">children</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

			<span class="nx">$currElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$currElement</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">))</span> <span class="p">{</span>

				<span class="nx">jsonNavPoint</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">$currElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">$currElement</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;navLabel&quot;</span><span class="p">))</span> <span class="p">{</span>

				<span class="nx">jsonNavPoint</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="nx">$currElement</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">text</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">$currElement</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;navPoint&quot;</span><span class="p">))</span> <span class="p">{</span>

				<span class="nx">jsonNavPoint</span><span class="p">.</span><span class="nx">navs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">createNavPointObject</span><span class="p">(</span><span class="nx">$currElement</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">});</span>

		<span class="k">return</span> <span class="nx">jsonNavPoint</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">TocView</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">NcxTocView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">});</span>
	<span class="p">}</span>
<span class="p">});</span>

<span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">XhtmlToc</span> <span class="o">=</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Toc</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

	<span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{};</span>
		<span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DOMParser</span><span class="p">;</span>
      		<span class="nx">xmlDom</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">,</span> <span class="s1">&#39;text/xml&#39;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">json</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">xmlDom</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
		<span class="nx">json</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="nx">xmlDom</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">TocView</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">XhtmlTocView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">});</span>
	<span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 